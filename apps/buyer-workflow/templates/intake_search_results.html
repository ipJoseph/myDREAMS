{% extends "base.html" %}

{% block title %}Search Results - DREAMS{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">Search Results</h1>
        <div style="color: var(--gray-500);">
            {{ form.form_name or 'Search' }} for {{ lead.first_name }} {{ lead.last_name }}
            | {{ properties|length }} properties found
        </div>
    </div>
    <div style="display: flex; gap: 0.5rem;">
        <a href="{{ url_for('intake_edit', form_id=form.id) }}" class="btn btn-secondary">Edit Criteria</a>
        <form method="POST" action="{{ url_for('package_save') }}" style="display: inline;">
            <input type="hidden" name="lead_id" value="{{ lead.id }}">
            <input type="hidden" name="intake_form_id" value="{{ form.id }}">
            <input type="hidden" name="name" value="{{ form.form_name or 'Property Package' }} - {{ now().strftime('%b %d') if now else 'Today' }}">
            <button type="submit" class="btn btn-primary">Create Package from Results</button>
        </form>
    </div>
</div>

<div class="card" style="margin-bottom: 1rem; padding: 1rem;">
    <strong>Search Criteria:</strong>
    {% if form.min_price or form.max_price %}
        Price: ${{ "{:,}".format(form.min_price|int) if form.min_price else '0' }} - ${{ "{:,}".format(form.max_price|int) if form.max_price else 'Any' }}
    {% endif %}
    {% if form.min_beds %}| {{ form.min_beds }}+ beds{% endif %}
    {% if form.min_baths %}| {{ form.min_baths }}+ baths{% endif %}
    {% if form.counties %}| Counties: {{ form.counties }}{% endif %}
</div>

{% if properties %}
<div class="property-grid">
    {% for prop in properties %}
    <div class="property-card">
        <div class="property-image" style="background-image: url('{{ prop.primary_photo or prop.photo_urls or '' }}');">
            {% if not prop.primary_photo and not prop.photo_urls %}
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--gray-500);">
                No Photo
            </div>
            {% endif %}
        </div>
        <div class="property-info">
            <div class="property-price">${{ "{:,}".format(prop.price) if prop.price else 'N/A' }}</div>
            <div class="property-address">{{ prop.address }}</div>
            <div style="color: var(--gray-500); font-size: 0.875rem; margin-bottom: 0.5rem;">
                {{ prop.city }}, {{ prop.state }} {{ prop.zip }} | {{ prop.county }} County
            </div>
            <div class="property-details">
                <span>{{ prop.beds or '-' }} bd</span>
                <span>{{ prop.baths or '-' }} ba</span>
                <span>{{ "{:,}".format(prop.sqft) if prop.sqft else '-' }} sqft</span>
                {% if prop.acreage %}<span>{{ prop.acreage }} ac</span>{% endif %}
            </div>
            <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem;">
                {% if prop.redfin_url %}
                <a href="{{ prop.redfin_url }}" target="_blank" class="btn btn-sm btn-secondary">Redfin</a>
                {% endif %}
                {% if prop.mls_number %}
                <span class="badge badge-gray">MLS# {{ prop.mls_number }}</span>
                {% endif %}
                {% if prop.days_on_market %}
                <span class="badge badge-primary">{{ prop.days_on_market }} DOM</span>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card" style="text-align: center; padding: 3rem;">
    <h3>No Properties Found</h3>
    <p style="color: var(--gray-500);">
        Try adjusting the search criteria to find more properties.
    </p>
    <a href="{{ url_for('intake_edit', form_id=form.id) }}" class="btn btn-primary" style="margin-top: 1rem;">
        Edit Search Criteria
    </a>
</div>
{% endif %}
{% endblock %}
